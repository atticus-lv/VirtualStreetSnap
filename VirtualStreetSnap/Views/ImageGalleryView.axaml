<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:viewModels="clr-namespace:VirtualStreetSnap.ViewModels"
             xmlns:views="clr-namespace:VirtualStreetSnap.Views"
             mc:Ignorable="d" d:DesignWidth="1280" d:DesignHeight="720"
             x:Class="VirtualStreetSnap.Views.ImageGalleryView"
             x:DataType="viewModels:ImageGalleryViewModel">

    <UserControl.DataContext>
        <viewModels:ImageGalleryViewModel />
    </UserControl.DataContext>


    <Grid RowDefinitions="*,Auto" Background="#111111">
        <!-- Selected Image Display -->
        <Border Grid.Row="0" CornerRadius="5" Padding="2">
            <Panel>
                <TextBlock Text="Select an Image" HorizontalAlignment="Center" VerticalAlignment="Center" />
                <Viewbox x:Name="ImageViewbox" Stretch="Uniform"
                         PointerPressed="ImageViewbox_PointerPressed"
                         PointerReleased="ImageViewbox_PointerReleased"
                         PointerMoved="ImageViewbox_PointerMoved">
                    <Image Source="{Binding SelectedImage}" />
                    <Viewbox.ContextMenu>
                        <ContextMenu>
                            <MenuItem Command="{Binding CopySelectedImage}">
                                <MenuItem.Header>
                                    <StackPanel Orientation="Horizontal" Spacing="5">
                                        <PathIcon Data="{StaticResource ImageCopyRegular}" />
                                        <TextBlock VerticalAlignment="Center" Text="Copy Image" />
                                    </StackPanel>
                                </MenuItem.Header>
                            </MenuItem>

                            <MenuItem Click="ResetImageViewBox">
                                <MenuItem.Header>
                                    <StackPanel Orientation="Horizontal" Spacing="5">
                                        <PathIcon Data="{StaticResource ArrowRotateLeftRegular}" />
                                        <TextBlock VerticalAlignment="Center" Text="Reset Zoom" />
                                    </StackPanel>
                                </MenuItem.Header>
                            </MenuItem>
                            <MenuItem Click="FlipHorizontally_Click">
                                <MenuItem.Header>
                                    <StackPanel Orientation="Horizontal" Spacing="5">
                                        <PathIcon Data="{StaticResource FlipHorizontalRegular}" />
                                        <TextBlock VerticalAlignment="Center" Text="Flip Horizontally" />
                                    </StackPanel>
                                </MenuItem.Header>
                            </MenuItem>
                            <MenuItem Click="FlipVertically_Click">
                                <MenuItem.Header>
                                    <StackPanel Orientation="Horizontal" Spacing="5">
                                        <PathIcon Data="{StaticResource FlipVerticalRegular}" />
                                        <TextBlock VerticalAlignment="Center" Text="Flip Vertically" />
                                    </StackPanel>
                                </MenuItem.Header>
                            </MenuItem>
                        </ContextMenu>
                    </Viewbox.ContextMenu>
                </Viewbox>
                <TextBlock Text="{Binding SelectedImageName}" Margin="2">
                    <TextBlock.Effect>
                        <DropShadowEffect Color="Black" BlurRadius="3" Opacity="1" OffsetX="0" OffsetY="0" />
                    </TextBlock.Effect>
                </TextBlock>
                <StackPanel VerticalAlignment="Bottom" Background="Transparent" Orientation="Horizontal" Height="30"
                            Opacity="0.7">
                    <Button Command="{Binding ToggleThumbnailBar}">
                        <PathIcon Data="{StaticResource ArrowMaximizeVerticalRegular}" />
                    </Button>
                    <Button Height="30" Command="{Binding ReLoadThumbnails}">
                        <PathIcon Data="{StaticResource ApprovalsAppRegular}"></PathIcon>
                    </Button>
                </StackPanel>

            </Panel>
        </Border>

        <!-- Thumbnails Display -->
        <ScrollViewer x:Name="ThumbnailsScrollViewer" Grid.Row="1" HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Disabled"
                      ScrollChanged="ThumbnailsScrollViewer_ScrollChanged"
                      IsVisible="{Binding ShowThumbnailBar}">
            <ListBox ItemsSource="{Binding Thumbnails}"
                     SelectedItem="{Binding SelectedThumbnail}"
                     HorizontalAlignment="Left" Background="Transparent"
                     SelectionMode="Single">
                <ListBox.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Delete" Command="{Binding DeleteSelectedThumbnail}" />
                        <MenuItem Header="Open In Folder" Command="{Binding OpenSelectedThumbnailFolder}" />
                    </ContextMenu>
                </ListBox.ContextMenu>
                <ListBox.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal" />
                    </ItemsPanelTemplate>
                </ListBox.ItemsPanel>
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <views:ImageThumbView DataContext="{Binding}" Width="100" Height="100" />
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </ScrollViewer>
    </Grid>
</UserControl>